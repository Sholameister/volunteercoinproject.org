<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>LVBTN Signup & KYC</title>
  <style>
    body { background:#fdf2f8; font-family:'Segoe UI',sans-serif; text-align:center; padding:20px; }
    h2 { margin: 0 0 8px; }
    p { margin: 8px 0; }
    button { background:#e60073; color:#fff; padding:12px 20px; border:none; border-radius:6px; font-size:16px; margin:10px; cursor:pointer; }
    button:hover { background:#cc005f; }
    #walletAddress,#walletStatus,#kycStatus,#tierInfo,#signupWalletDisplay { font-weight:bold; margin:10px 0; }
    ul { list-style:none; text-align:left; max-width:420px; margin:20px auto; padding:0; }
    ul li { margin:6px 0; }
    .tier-badge { padding:4px 10px; border-radius:4px; font-weight:bold; display:inline-block; }
    .tier-1 { background:#ffe0e0; color:#c0392b }
    .tier-2 { background:#fff3cd; color:#856404 }
    .tier-3 { background:#d4edda; color:#155724 }
    .nav-button { display:inline-block; margin:8px; padding:10px 14px; border-radius:6px; background:#f3f4f6; text-decoration:none; color:#111827; font-size:14px; }
  </style>
</head>
<body>
  <h2>Sign Up & KYC Verification</h2>
  <p style="font-style:italic;color:#333;">
    To unlock volunteer rewards, please complete the KYC process below. The more verified you are, the more access and token rewards you‚Äôll earn!
  </p>

  <!-- Wallet -->
  <button id="connectWalletBtn">Connect Wallet</button>
  <p id="signupWalletDisplay"></p>
  <p id="walletAddress"></p>
  <p id="walletStatus"></p>

  <!-- KYC / Tier -->
  <p id="kycStatus">KYC: ‚è≥ Pending</p>
  <div id="tierInfo" class="tier-badge tier-1">Tier: 1</div>

  <!-- Blockpass -->
  <div style="margin-top:12px;">
    <a href="https://verify-with.blockpass.org/?clientId=volunteer_coin_project_68f8b" target="_blank" rel="noopener">
      <button>Start KYC</button>
    </a>
  </div>

  <!-- Rewards blurb -->
  <ul>
    <li>üíó LVBTN Token Earnings (example):</li>
    <li>‚Ä¢ Tier 1 ‚Äì 5 SYNCM/hr (basic signup)</li>
    <li>‚Ä¢ Tier 2 ‚Äì 10 SYNCM/hr (KYC + driver)</li>
    <li>‚Ä¢ Tier 3 ‚Äì 15 SYNCM/hr (KYC + 2 refs + 25+ hours)</li>
  </ul>

  <!-- Nav -->
  <a href="./login.html" class="nav-button" target="_blank" rel="noopener">Go to Login</a>
  <a href="./index.html" class="nav-button" target="_blank" rel="noopener">Go to Home</a>

<div id="walletDebug" style="font:12px/1.3 system-ui; background:#fff8c5; border:1px solid #f2d388; padding:8px; border-radius:6px; margin:10px auto; max-width:420px; display:none"></div>
<script>
  (function(){
    const d = document.getElementById('walletDebug');
    const detected = {
      phantom: !!(window?.phantom?.solana && window.phantom.solana.isPhantom) || !!(window?.solana?.isPhantom),
      solflare: !!window?.solflare?.isSolflare,
      backpack: !!window?.backpack?.solana,
      glow: !!window?.glow?.solana,
      exodus: !!window?.exodus?.solana,
      trust: !!window?.trustwallet?.solana
    };
    const httpsOK = location.protocol === 'https:' || ['localhost','127.0.0.1'].includes(location.hostname);
    d.innerText = 'Wallet detect ‚Üí ' + JSON.stringify(detected) + ' | HTTPS/localhost: ' + httpsOK + ' | UA: ' + navigator.userAgent;
    d.style.display = 'block';
  })();
</script>

  <!-- SAFETY-NET: ensures Connect Wallet button actually does something -->
<script type="module">
  // 1) Load the multi-wallet connector
  import { connectWallet } from './js/connectWallet.js';

  // 2) Grab the button (both pages use the same id)
  const btn = document.getElementById('connectWalletBtn');

  // 3) Minimal wallet detection (for user-friendly hints)
  const walletsDetected = Boolean(
    (window?.phantom?.solana && window.phantom.solana.isPhantom) ||
    (window?.solana?.isPhantom) ||
    (window?.solflare?.isSolflare) ||
    (window?.backpack?.solana) ||
    (window?.glow?.solana) ||
    (window?.exodus?.solana) ||
    (window?.trustwallet?.solana)
  );
  const httpsOK = location.protocol === 'https:' || ['localhost','127.0.0.1'].includes(location.hostname);

  // 4) Add a small one-time helper if nothing is injected
  const helperId = 'walletHelpInline';
  if (!walletsDetected) {
    const div = document.createElement('div');
    div.id = helperId;
    div.style.cssText = 'max-width:420px;margin:10px auto;padding:10px;border:1px solid #f2d388;background:#fff8c5;border-radius:6px;font:13px system-ui';
    div.innerHTML = `
      <b>No wallet detected here.</b><br>
      Desktop: use Chrome/Brave with Phantom or Solflare extension installed.<br>
      Mobile: open this site inside your wallet app‚Äôs browser (Phantom ‚Üí Browser tab).
    `;
    document.body.appendChild(div);
  }

  // 5) Ensure the button exists and bind a guaranteed click handler
  if (btn) {
    // Remove any previous listeners (if a stale SW kept an old script)
    btn.replaceWith(btn.cloneNode(true));
    const wiredBtn = document.getElementById('connectWalletBtn');

    wiredBtn.addEventListener('click', async () => {
      try {
        if (!httpsOK) {
          alert('Wallet requires HTTPS or localhost.');
          return;
        }
        const addr = await connectWallet();
        if (addr) {
          alert('‚úÖ Connected: ' + addr);
        } else {
          alert('‚ö†Ô∏è Connect failed (no address returned).');
        }
      } catch (e) {
        console.error('Connect error:', e);
        alert('‚ùå Wallet connect error: ' + (e?.message || e));
      }
    });
  } else {
    console.warn('Connect button #connectWalletBtn not found on this page.');
  }
</script>
<body>
  <!-- Page content -->

  <!-- Solana web3.js -->
  <script src="https://unpkg.com/@solana/web3.js@1.95.3/lib/index.iife.min.js"></script>
  <script type="module" src="./connectWallet.js"></script>
  <script type="module" src="./firebaseConfig.js"></script>
  <script type="module" src="./kycUtils.js"></script>
  <script type="module" src="./signup.js"></script>
  <script type="module" src="./loginLogic.js"></script>
</body>

</body>
</html>
